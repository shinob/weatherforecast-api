# クイックスタートガイド

## 「Failed to fetch」エラーの解決方法

このエラーは **CORS（Cross-Origin Resource Sharing）問題** が原因です。

## 解決策

### ステップ1: プロキシサーバーを起動

```bash
cd /path/to/weatherforecast-api/examples
python3 server-proxy.py 8000
```

以下のような出力が表示されれば成功です：

```
======================================================================
CORS対応プロキシサーバーを起動しました
======================================================================

ポート: 8000

アクセス方法:
  - http://localhost:8000
  - http://127.0.0.1:8000
  - http://[::1]:8000

機能:
  ✓ 天気予報APIへのプロキシ
  ✓ CORS問題の自動解決
  ✓ IPv4/IPv6 両対応

APIエンドポイント:
  /api/weather/{token}/{lat},{lng}

終了するには Ctrl+C を押してください
======================================================================
```

### ステップ2: ブラウザでアクセス

ブラウザで以下のURLを開きます：

```
http://localhost:8000
```

### ステップ3: 地図をクリック

1. 地図が表示されたら、任意の地点をクリック
2. マーカーが表示され、天気予報が読み込まれます
3. 右側に24時間予報とグラフが表示されます

## トラブルシューティング

### Q1: ポート8000が既に使用されている

別のポート番号を指定してください：

```bash
python3 server-proxy.py 8080
```

その後、`http://localhost:8080` でアクセス

### Q2: Pythonがインストールされていない

Ubuntu/Debianの場合：
```bash
sudo apt install python3
```

### Q3: まだ「Failed to fetch」エラーが出る

1. ブラウザの開発者ツール（F12）を開く
2. コンソールタブでエラーメッセージを確認
3. ネットワークタブでリクエストの状態を確認

よくある原因：
- プロキシサーバーが起動していない
- 違うポートでサーバーを起動したがURLを変更していない
- ブラウザキャッシュが残っている → Ctrl+Shift+R で強制リロード

### Q4: APIトークンエラー

`config.js` でAPIトークンを確認：

```javascript
API_TOKEN: 'api_sample',  // サンプルトークン
```

サンプルトークンで動作しない場合は、有効なAPIトークンを取得して設定してください。

## 仕組みの説明

### なぜプロキシサーバーが必要？

1. **CORS制限**: ブラウザのセキュリティ機能により、異なるドメイン（オリジン）へのリクエストは制限されます
2. **天気予報API**: `weather.ittools.biz` はCORSヘッダーを返さないため、直接アクセスできません
3. **プロキシサーバー**: サーバー側でAPIを呼び出し、CORSヘッダーを追加してブラウザに返します

### 通信フロー

```
ブラウザ → プロキシサーバー → 天気予報API
         ← (CORSヘッダー付き) ←
```

プロキシサーバーは以下の処理を行います：
1. ブラウザからのリクエストを受信
2. 天気予報APIにHTTPSリクエストを送信
3. APIからのレスポンスにCORSヘッダーを追加
4. ブラウザにレスポンスを返す

## IPv6でアクセスする場合

`server-proxy.py` はIPv6にも対応しています：

```
http://[::1]:8000                # IPv6ローカル
http://[2001:db8::1]:8000        # IPv6グローバル（例）
```

## 本番環境での利用

本番環境では：
1. Nginx、Apache等のWebサーバーをリバースプロキシとして設定
2. または、バックエンドAPI（Node.js、Python Flask等）を作成
3. `config.js` の `API_TOKEN` を有効なトークンに変更

## サポート

問題が解決しない場合は、以下の情報を確認してください：
- ブラウザの開発者ツール（F12）のコンソールログ
- プロキシサーバーのターミナル出力
- ネットワーク接続状態
